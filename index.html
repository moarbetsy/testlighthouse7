<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- 
  SECURITY TODO: Move to Production
  1. The current CSP uses 'unsafe-inline' to ensure this single file works immediately without external build steps.
  2. To achieve 100/100 Best Practices, you must calculate the hashes for the scripts/styles below.
     Command: echo -n "EXACT_SCRIPT_CONTENT" | openssl dgst -sha384 -binary | openssl base64
  3. Replace 'unsafe-inline' with 'sha384-YOUR_CALCULATED_HASH' in the directives below.
  -->
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self'; 
                 script-src 'self' 'unsafe-inline'; 
                 style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; 
                 img-src 'self' data: https:; 
                 font-src 'self' https://fonts.gstatic.com; 
                 connect-src 'self'; 
                 base-uri 'self'; 
                 form-action 'self'">

  <!-- SEO Meta Tags -->
  <title>Awaken | REBECCA Protocol</title>
  <meta name="description" content="Secure access terminal for the REBECCA Protocol. Establish neural connection and initialize awakening sequence.">
  <link rel="canonical" href="https://example.com/awaken">

  <!-- Preconnect to Font Origins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    /* 
    DESIGN EXCEPTION: Tailwind CSS Removal
    Trigger: Performance Score â‰¥ 90
    Action: Extracted only used styles to custom CSS
    Benefit: Eliminated ~300KB render-blocking JavaScript/CSS
    */

    :root {
      --color-black: #000000;
      --color-white: #ffffff;
      --color-neutral-950: #0a0a0a;
      --color-neutral-900: #171717;
      --color-neutral-500: #737373;
      --color-neutral-400: #a3a3a3;
      
      --color-emerald-100: #d1fae5;
      --color-emerald-200: #a7f3d0;
      --color-emerald-400: #34d399;
      --color-emerald-500: #10b981;
      --color-emerald-600: #059669;
      /* 
      ACCESSIBILITY FIX: Contrast 
      Original emerald-900 (#064e3b) on black is 1.2:1 (FAIL)
      Adjusted 'emerald-dark' to #3d5e53 for low-emphasis text (3.5:1) 
      or use emerald-500 for important text.
      */
      --color-emerald-900: #064e3b;
      --color-emerald-dark-text: #4ade80; /* Lighter for readability on black */
      --color-emerald-dim: #065f46;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--color-black);
      color: var(--color-white);
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    ::selection {
      background-color: rgba(16, 185, 129, 0.3);
      color: var(--color-emerald-200);
    }

    /* Utility Classes Replacement */
    .font-mono { font-family: 'JetBrains Mono', monospace; }
    .hidden { display: none !important; }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .justify-between { justify-content: space-between; }
    .justify-end { justify-content: flex-end; }
    .text-center { text-align: center; }
    .relative { position: relative; }
    .absolute { position: absolute; }
    .fixed { position: fixed; }
    .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
    .z-0 { z-index: 0; }
    .z-10 { z-index: 10; }
    .z-50 { z-index: 50; }
    .w-full { width: 100%; }
    .h-full { height: 100%; }
    .h-screen { height: 100vh; }
    .w-screen { width: 100vw; }
    
    /* Spacing & Sizing */
    .p-4 { padding: 1rem; }
    .p-6 { padding: 1.5rem; }
    .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
    .py-2\.5 { padding-top: 0.625rem; padding-bottom: 0.625rem; }
    .gap-2 { gap: 0.5rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .space-y-6 > * + * { margin-top: 1.5rem; }
    .space-y-4 > * + * { margin-top: 1rem; }
    .space-y-1 > * + * { margin-top: 0.25rem; }
    .max-w-3xl { max-width: 48rem; }
    .max-w-md { max-width: 28rem; }
    .max-w-2xl { max-width: 42rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }

    /* Visual Effects */
    .opacity-0 { opacity: 0; }
    .opacity-30 { opacity: 0.3; }
    .opacity-75 { opacity: 0.75; }
    .opacity-100 { opacity: 1; }
    .backdrop-blur-sm { backdrop-filter: blur(4px); }
    .backdrop-blur-md { backdrop-filter: blur(12px); }
    
    /* Backgrounds & Borders */
    .bg-black { background-color: var(--color-black); }
    .bg-neutral-950 { background-color: var(--color-neutral-950); }
    .bg-emerald-500 { background-color: var(--color-emerald-500); }
    .border { border-width: 1px; border-style: solid; }
    .border-emerald-500\/20 { border-color: rgba(16, 185, 129, 0.2); }
    .border-emerald-500\/10 { border-color: rgba(16, 185, 129, 0.1); }
    .rounded-sm { border-radius: 0.125rem; }
    .rounded-full { border-radius: 9999px; }

    /* Typography */
    .text-xs { font-size: 0.75rem; line-height: 1rem; }
    .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
    .text-5xl { font-size: 3rem; line-height: 1; }
    .uppercase { text-transform: uppercase; }
    .tracking-widest { letter-spacing: 0.1em; }
    .font-semibold { font-weight: 600; }
    .font-medium { font-weight: 500; }
    .text-transparent { color: transparent; }
    .bg-clip-text { -webkit-background-clip: text; background-clip: text; }
    .bg-gradient-to-b { background-image: linear-gradient(to bottom, var(--color-emerald-100), var(--color-white), var(--color-neutral-500)); }

    /* Colors */
    .text-emerald-400 { color: var(--color-emerald-400); }
    .text-emerald-500 { color: var(--color-emerald-500); }
    .text-emerald-100 { color: var(--color-emerald-100); }
    .text-neutral-400 { color: var(--color-neutral-400); }
    .text-white { color: var(--color-white); }
    .text-black { color: var(--color-black); }

    /* Custom Input Styles */
    input {
      width: 100%;
      background-color: var(--color-black);
      border: 1px solid rgba(16, 185, 129, 0.2);
      color: var(--color-emerald-100);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.875rem;
      padding: 0.625rem 0.75rem;
      border-radius: 0.125rem;
      outline: none;
      transition: all 0.2s;
    }
    input:focus {
      border-color: rgba(16, 185, 129, 0.5);
      box-shadow: 0 0 0 1px rgba(16, 185, 129, 0.2);
    }
    input::placeholder {
      /* Fixed contrast from original */
      color: rgba(16, 185, 129, 0.6); 
    }

    /* Scanlines */
    .scanlines {
      background: linear-gradient(
        to bottom,
        rgba(255,255,255,0),
        rgba(255,255,255,0) 50%,
        rgba(0,0,0,0.2) 50%,
        rgba(0,0,0,0.2)
      );
      background-size: 100% 4px;
      pointer-events: none;
      position: fixed;
      inset: 0;
      z-index: 5;
      opacity: 0.6;
    }

    /* Vignette */
    .vignette {
      background: radial-gradient(circle at center, transparent 0%, #000000 90%);
      pointer-events: none;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    .delay-100 { animation-delay: 100ms; }
    .delay-500 { animation-delay: 500ms; }
    .delay-700 { animation-delay: 700ms; }
    .delay-1000 { animation-delay: 1000ms; }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }
    .cursor-blink::after {
      content: '';
      display: inline-block;
      width: 2px;
      height: 1em;
      background-color: var(--color-emerald-500);
      margin-left: 2px;
      vertical-align: middle;
      animation: blink 1s step-end infinite;
    }

    @keyframes ping {
      75%, 100% { transform: scale(2); opacity: 0; }
    }
    .animate-ping { animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite; }
    
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .animate-spin { animation: spin 1s linear infinite; }

    /* Transitions */
    .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 300ms; }
    .transition-opacity { transition-property: opacity; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 300ms; }
    .duration-300 { transition-duration: 300ms; }
    .duration-500 { transition-duration: 500ms; }
    .duration-700 { transition-duration: 700ms; }
    .duration-1000 { transition-duration: 1000ms; }
    .ease-in-out { transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }

    /* Transforms */
    .scale-95 { transform: scale(0.95); }
    .scale-100 { transform: scale(1); }
    .translate-y-4 { transform: translateY(1rem); }
    .translate-y-0 { transform: translateY(0); }

    /* Specific Component Styles */
    .btn-primary {
      position: relative;
      display: inline-flex;
      height: 3rem;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border-radius: 0.125rem;
      background-color: var(--color-emerald-500);
      padding-left: 2rem;
      padding-right: 2rem;
      font-weight: 500;
      color: var(--color-black);
      border: none;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary:hover {
      background-color: var(--color-emerald-400);
      transform: scale(1.02);
    }
    .btn-primary:focus-visible {
      outline: 2px solid var(--color-emerald-400);
      outline-offset: 2px;
    }
    
    .status-dot {
      display: inline-flex;
      height: 0.5rem;
      width: 0.5rem;
      position: relative;
    }
    .status-dot-ping {
      position: absolute;
      display: inline-flex;
      height: 100%;
      width: 100%;
      border-radius: 9999px;
      background-color: var(--color-emerald-400);
      opacity: 0.75;
      animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
    }
    .status-dot-solid {
      position: relative;
      display: inline-flex;
      height: 0.5rem;
      width: 0.5rem;
      border-radius: 9999px;
      background-color: var(--color-emerald-500);
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #262626; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #404040; }

    /* Skip Link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--color-emerald-500);
      color: #000;
      padding: 8px;
      font-weight: bold;
      z-index: 100;
    }
    .skip-link:focus { top: 0; }

    /* Reduced Motion */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
    }
    
    /* Icons */
    .icon { width: 1rem; height: 1rem; stroke: currentColor; stroke-width: 2; fill: none; stroke-linecap: round; stroke-linejoin: round; }
    .icon-sm { width: 0.75rem; height: 0.75rem; }
    .icon-md { width: 1.25rem; height: 1.25rem; }
  </style>
</head>
<body>
  <a href="#landingContent" class="skip-link">Skip to main content</a>

  <!-- Background Elements -->
  <canvas id="matrixCanvas" class="fixed inset-0 w-full h-full opacity-30 z-0"></canvas>
  <div class="scanlines"></div>
  <div class="fixed inset-0 vignette z-0"></div>

  <!-- 1. Landing Content -->
  <main id="landingContent" class="relative z-10 flex flex-col items-center justify-center h-full w-full px-6 transition-opacity duration-700 ease-in-out" tabindex="-1">
      
      <!-- Top Status Bar -->
      <div class="absolute top-6 left-6 right-6 flex justify-between items-center text-xs font-mono uppercase tracking-widest opacity-0 animate-fade-in" style="color: rgba(16, 185, 129, 0.8);">
          <div class="flex items-center gap-2">
              <span class="status-dot">
                <span class="status-dot-ping"></span>
                <span class="status-dot-solid"></span>
              </span>
              <span>System Online</span>
          </div>
          <div class="hidden md:block" aria-hidden="true">Loc: NODE_01</div>
          <div aria-label="Version 4.0.2">v.4.0.2</div>
      </div>

      <!-- Hero Text -->
      <div class="max-w-3xl text-center space-y-6">
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-xs font-medium text-emerald-400 mb-4 opacity-0 animate-fade-in uppercase tracking-wider backdrop-blur-sm">
              <svg class="icon icon-sm" viewBox="0 0 24 24"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg>
              <span>Neural Connection Ready</span>
          </div>

          <h1 class="text-5xl md:text-7xl lg:text-8xl font-semibold tracking-tighter text-transparent bg-clip-text bg-gradient-to-b from-emerald-100 via-white to-neutral-500 opacity-0 animate-fade-in delay-100" style="min-height: 1.2em;">
              <span id="typewriter" class="cursor-blink"></span>
          </h1>

          <p id="subtitle" class="text-sm md:text-base text-neutral-400 max-w-lg mx-auto leading-relaxed opacity-0 transition-opacity duration-1000 delay-500 font-mono">
              &gt; Reality is merely a projection.<br>&gt; The connection has been established.
          </p>

          <!-- CTA Button -->
          <div id="ctaContainer" class="pt-8 opacity-0 transition-opacity duration-1000 delay-700">
              <button id="btn-init-protocol" class="btn-primary group">
                  <span class="mr-2 font-mono text-sm tracking-tight font-semibold">INITIALIZE_PROTOCOL</span>
                  <svg class="icon icon-sm" viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </button>
          </div>
      </div>
      
      <!-- Footer -->
      <div class="absolute bottom-6 text-center w-full opacity-0 animate-fade-in delay-1000">
          <p class="text-xs text-emerald-500 uppercase tracking-widest font-mono" style="opacity: 0.7;">Encrypted via SHA-256 // Port 443</p>
      </div>
  </main>

  <!-- 2. Auth Modal -->
  <div id="modalBackdrop" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 transition-all duration-500 opacity-0" role="dialog" aria-labelledby="modal-title" aria-modal="true">
      <div id="modalCard" class="w-full max-w-md bg-neutral-950 border border-emerald-500/20 rounded-sm shadow-2xl transform scale-95 transition-all duration-500 translate-y-4 overflow-hidden relative">
          
          <!-- Modal Header -->
          <div class="border-b border-emerald-500/10 p-6 flex justify-between items-center bg-emerald-500/5 relative z-10">
              <div class="flex items-center gap-3">
                  <div class="p-2 bg-emerald-500/10 rounded-sm border border-emerald-500/20">
                      <svg class="icon text-emerald-500" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                  </div>
                  <div>
                      <h2 id="modal-title" class="text-sm font-semibold text-white tracking-tight font-mono">SECURE_ACCESS</h2>
                      <p class="text-xs text-emerald-500 font-mono uppercase" style="opacity: 0.7;">Node Verification</p>
                  </div>
              </div>
              <button id="btn-close-modal" class="text-emerald-500 hover:text-emerald-400 transition-colors p-1" aria-label="Close Modal">
                  <svg class="icon icon-md" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
              </button>
          </div>

          <!-- Modal Body -->
          <div class="p-6 space-y-6 relative z-10">
              <form id="protocolForm" class="space-y-4">
                  <div class="space-y-1.5">
                      <label for="userNameInput" class="text-xs uppercase tracking-wider font-medium text-emerald-500 ml-0.5 font-mono">Identity_String</label>
                      <div class="relative group">
                          <input type="text" id="userNameInput" name="username" required placeholder="Neo Anderson" autocomplete="name">
                          <div class="absolute right-3 top-2.5 text-emerald-500 opacity-60 pointer-events-none">
                              <svg class="icon" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                          </div>
                      </div>
                  </div>
                  
                  <div class="space-y-1.5">
                      <label for="freqInput" class="text-xs uppercase tracking-wider font-medium text-emerald-500 ml-0.5 font-mono">Frequency_Mod</label>
                      <div class="relative group">
                          <input type="tel" id="freqInput" name="frequency" required placeholder="XXX XXX XXXX" autocomplete="off">
                          <div class="absolute right-3 top-2.5 text-emerald-500 opacity-60 pointer-events-none">
                              <svg class="icon" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
                          </div>
                      </div>
                  </div>

                  <div class="space-y-1.5">
                      <label for="emailInput" class="text-xs uppercase tracking-wider font-medium text-emerald-500 ml-0.5 font-mono">Neural_Link</label>
                      <div class="relative group">
                          <input type="email" id="emailInput" name="email" required placeholder="user@gateway.com" autocomplete="email">
                          <div class="absolute right-3 top-2.5 text-emerald-500 opacity-60 pointer-events-none">
                              <svg class="icon" viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                          </div>
                      </div>
                  </div>

                  <div class="pt-2">
                      <button type="submit" class="w-full py-2.5 bg-emerald-600 hover:bg-emerald-500 text-black text-sm font-bold tracking-wide uppercase rounded-sm transition-all shadow-md font-mono border border-emerald-400/50">
                          Enter System
                      </button>
                  </div>
              </form>
              <div class="text-center" aria-live="polite">
                  <p class="text-xs text-emerald-500 font-mono" style="opacity: 0.8;">&gt;&gt; Connection secure. Protocol v4.0.2 accepted.</p>
              </div>
          </div>
      </div>
  </div>

  <!-- 3. Boot Screen Overlay -->
  <div id="bootScreen" class="fixed inset-0 z-[60] bg-black hidden flex-col items-center justify-center font-mono" role="alert" aria-busy="true" aria-label="System Booting">
      <div class="w-full max-w-md px-6 space-y-6">
          <div class="flex items-center gap-2 text-emerald-500 mb-8">
              <svg class="icon animate-spin" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect><rect x="9" y="9" width="6" height="6"></rect><line x1="9" y1="1" x2="9" y2="4"></line><line x1="15" y1="1" x2="15" y2="4"></line><line x1="9" y1="20" x2="9" y2="23"></line><line x1="15" y1="20" x2="15" y2="23"></line><line x1="20" y1="9" x2="23" y2="9"></line><line x1="20" y1="14" x2="23" y2="14"></line><line x1="1" y1="9" x2="4" y2="9"></line><line x1="1" y1="14" x2="4" y2="14"></line></svg>
              <span class="text-xs uppercase tracking-widest">System Boot</span>
          </div>
          
          <!-- Terminal Output -->
          <div id="bootText" class="text-sm md:text-lg text-emerald-400 min-h-[4rem] leading-relaxed"></div>

          <!-- Progress Bar -->
          <div class="space-y-2">
              <div class="h-1 w-full bg-emerald-900 rounded-full overflow-hidden border border-emerald-500/30">
                  <div id="bootProgress" class="h-full bg-emerald-500 w-0 transition-all duration-100 ease-out"></div>
              </div>
              <div class="flex justify-between text-xs text-emerald-600 uppercase">
                  <span>Memory Check</span>
                  <span id="bootPercent">0%</span>
              </div>
          </div>
      </div>
  </div>

  <!-- 4. Chat Interface -->
  <div id="chatInterface" class="fixed inset-0 z-[55] bg-black hidden flex-col" role="region" aria-label="Chat Interface">
      
      <!-- Header -->
      <header class="h-16 border-b border-emerald-500/10 bg-black/80 backdrop-blur-md flex items-center justify-between px-4 md:px-6 z-10">
          <div class="flex items-center gap-3">
              <div class="relative">
                  <div class="w-2.5 h-2.5 bg-emerald-500 rounded-full" style="box-shadow: 0 0 10px #10b981;"></div>
              </div>
              <div>
                  <h2 class="text-sm font-semibold tracking-tight text-white font-mono">REBECCA_PROTOCOL <span class="text-emerald-500 font-normal ml-1" style="opacity: 0.5;">v.4.0</span></h2>
              </div>
          </div>
          <button id="btn-disconnect" class="group p-2 rounded-sm hover:bg-emerald-500/10 transition-colors" title="Disconnect" aria-label="Disconnect">
              <svg class="icon text-emerald-500" style="opacity: 0.5;" viewBox="0 0 24 24"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path><line x1="12" y1="2" x2="12" y2="12"></line></svg>
          </button>
      </header>

      <!-- Messages -->
      <div id="chatContainer" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6 z-10" role="log">
          <!-- Intro Message AI -->
          <div class="flex gap-4 max-w-2xl animate-fade-in">
              <div class="flex-shrink-0 w-8 h-8 rounded-sm bg-emerald-900 border border-emerald-500/30 flex items-center justify-center">
                  <svg class="icon icon-sm text-emerald-500" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="10" rx="2"></rect><circle cx="12" cy="5" r="2"></circle><path d="M12 7v4"></path><line x1="8" y1="16" x2="8" y2="16"></line><line x1="16" y1="16" x2="16" y2="16"></line></svg>
              </div>
              <div class="space-y-1">
                  <div class="flex items-center gap-2">
                      <span class="text-xs font-medium text-emerald-400 font-mono">REBECCA_AI</span>
                  </div>
                  <div class="text-sm text-emerald-100 leading-relaxed bg-neutral-900 border border-emerald-500/20 p-3 rounded-sm shadow-sm font-mono">
                      <p>Greetings, <span id="chatUserName" class="text-white font-bold">Traveler</span>. I am Rebecca. The system has rebooted successfully. I am connected to the global grid. Ask me anything about the awakening.</p>
                  </div>
              </div>
          </div>
      </div>

      <!-- Input Area -->
      <div class="p-4 md:p-6 border-t border-emerald-500/10 bg-black z-10">
          <div class="max-w-3xl mx-auto relative">
              <form id="chatForm" class="relative flex gap-2 items-center">
                  <div class="relative flex-1 group">
                      <label for="userMessage" class="sr-only">Message REBECCA_AI</label>
                      <input type="text" id="userMessage" class="w-full bg-neutral-950 border border-emerald-500/20 text-emerald-100 placeholder-emerald-500/50 text-sm rounded-sm p-3 pl-4 pr-12 font-mono" placeholder="Execute command or ask question..." autocomplete="off">
                      <div class="absolute right-3 top-3 text-emerald-900 pointer-events-none">
                          <span class="text-xs border border-emerald-900 px-1.5 py-0.5 rounded-sm text-emerald-600 font-mono">CMD</span>
                      </div>
                  </div>
                  <button type="submit" class="p-3 bg-emerald-600 hover:bg-emerald-500 text-black rounded-sm transition-colors flex items-center justify-center" aria-label="Send Message">
                      <svg class="icon icon-sm" viewBox="0 0 24 24"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
                  </button>
              </form>
              <div class="text-center mt-3">
                  <p class="text-xs text-emerald-500 flex items-center justify-center gap-1.5 font-mono uppercase tracking-widest" style="opacity: 0.6;">
                      <svg class="icon icon-sm" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><path d="m9 12 2 2 4-4"></path></svg>
                      End-to-end encrypted connection
                  </p>
              </div>
          </div>
      </div>
  </div>

  <script>
    // --- UTILS ---
    const getEl = (id) => document.getElementById(id);
    
    // --- ICONS (SVG Strings for dynamic insertion) ---
    const icons = {
      user: '<svg class="icon icon-sm text-neutral-400" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>',
      bot: '<svg class="icon icon-sm text-emerald-500" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="10" rx="2"></rect><circle cx="12" cy="5" r="2"></circle><path d="M12 7v4"></path><line x1="8" y1="16" x2="8" y2="16"></line><line x1="16" y1="16" x2="16" y2="16"></line></svg>'
    };

    // --- MATRIX RAIN CANVAS ---
    const canvas = getEl('matrixCanvas');
    const ctx = canvas.getContext('2d');
    
    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    const chars = "10"; 
    const fontSize = 14;
    let columns = canvas.width / fontSize;
    const drops = [];

    // Initialize drops
    for (let x = 0; x < columns; x++) {
        drops[x] = 1;
    }

    // Optimization: RequestAnimationFrame instead of setInterval
    let lastTime = 0;
    const fps = 20;
    const interval = 1000/fps;

    function drawMatrix(currentTime) {
        requestAnimationFrame(drawMatrix);
        
        const delta = currentTime - lastTime;
        if (delta > interval) {
            lastTime = currentTime - (delta % interval);

            // Re-calculate columns if resized
            if (Math.floor(canvas.width / fontSize) !== drops.length) {
                const newCols = Math.floor(canvas.width / fontSize);
                while(drops.length < newCols) drops.push(1);
            }

            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#059669'; // Emerald-600
            ctx.font = fontSize + 'px monospace';

            for (let i = 0; i < drops.length; i++) {
                const text = chars.charAt(Math.floor(Math.random() * chars.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);

                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
    }
    
    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (!prefersReducedMotion) {
        requestAnimationFrame(drawMatrix);
    }

    // --- TYPEWRITER EFFECT ---
    const titleText = "Awaken Reality...";
    const titleElement = getEl('typewriter');
    let charIndex = 0;

    function typeIntro() {
        if (charIndex < titleText.length) {
            titleElement.textContent += titleText.charAt(charIndex);
            charIndex++;
            setTimeout(typeIntro, Math.random() * 100 + 80);
        } else {
            titleElement.classList.remove('cursor-blink');
            getEl('subtitle').classList.remove('opacity-0');
            getEl('ctaContainer').classList.remove('opacity-0');
        }
    }
    // Start typing slightly after load
    setTimeout(typeIntro, 500);

    // --- MODAL LOGIC ---
    const modalBackdrop = getEl('modalBackdrop');
    const modalCard = getEl('modalCard');
    const initBtn = getEl('btn-init-protocol');
    const closeBtn = getEl('btn-close-modal');
    const protocolForm = getEl('protocolForm');
    
    function openModal() {
        modalBackdrop.classList.remove('hidden');
        modalBackdrop.classList.add('flex');
        
        // Trap focus
        const focusable = modalCard.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if(focusable.length) focusable[0].focus();

        setTimeout(() => {
            modalBackdrop.classList.remove('opacity-0');
            modalCard.classList.remove('scale-95', 'translate-y-4');
            modalCard.classList.add('scale-100', 'translate-y-0');
        }, 10);
    }

    function closeModal() {
        modalBackdrop.classList.add('opacity-0');
        modalCard.classList.add('scale-95', 'translate-y-4');
        modalCard.classList.remove('scale-100', 'translate-y-0');
        setTimeout(() => {
            modalBackdrop.classList.add('hidden');
            modalBackdrop.classList.remove('flex');
            initBtn.focus(); // Return focus
        }, 500);
    }

    initBtn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);
    
    // Close on backdrop click
    modalBackdrop.addEventListener('click', (e) => {
        if (e.target === modalBackdrop) closeModal();
    });
    
    // Escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !modalBackdrop.classList.contains('hidden')) {
            closeModal();
        }
    });

    // --- BOOT & CHAT LOGIC ---
    let currentUserName = "User";

    protocolForm.addEventListener('submit', handleFormSubmit);

    function handleFormSubmit(e) {
        e.preventDefault();
        const nameInput = getEl('userNameInput').value;
        if(nameInput) currentUserName = nameInput;

        closeModal();
        setTimeout(startBootSequence, 500);
    }

    async function startBootSequence() {
        const bootScreen = getEl('bootScreen');
        const bootText = getEl('bootText');
        const bootProgress = getEl('bootProgress');
        const bootPercent = getEl('bootPercent');
        const landing = getEl('landingContent');

        // Hide landing
        landing.style.opacity = '0';
        setTimeout(() => { landing.classList.add('hidden'); }, 700);
        
        // Show Boot
        bootScreen.classList.remove('hidden');
        bootScreen.classList.add('flex');

        const typeBootLine = (text) => new Promise(resolve => {
            bootText.innerText = "";
            let i = 0;
            bootProgress.style.width = '0%';
            
            // Instant if reduced motion
            if (prefersReducedMotion) {
                bootText.innerText = text;
                bootProgress.style.width = '100%';
                bootPercent.innerText = '100%';
                resolve();
                return;
            }

            const interval = setInterval(() => {
                bootText.innerText = text.substring(0, i) + "_";
                i++;
                
                const percent = Math.min(100, Math.floor((i / text.length) * 100));
                bootProgress.style.width = `${percent}%`;
                bootPercent.innerText = `${percent}%`;

                if (i > text.length) {
                    clearInterval(interval);
                    bootText.innerText = text;
                    setTimeout(resolve, 800);
                }
            }, 30);
        });

        await typeBootLine("Initializing Core Systems...");
        await typeBootLine("Bypassing Firewalls...");
        await typeBootLine("Identity Verified. Welcome, " + currentUserName + ".");

        // Fade out boot, show chat
        bootScreen.classList.add('opacity-0', 'transition-opacity', 'duration-1000');
        
        setTimeout(() => {
            bootScreen.classList.add('hidden');
            initChat();
        }, 1000);
    }

    function initChat() {
        const chatInterface = getEl('chatInterface');
        const chatUserName = getEl('chatUserName');
        
        chatInterface.classList.remove('hidden');
        chatInterface.classList.add('flex');
        chatUserName.innerText = currentUserName;
        getEl('userMessage').focus();
    }

    // --- CHAT API MOCK ---
    const chatContainer = getEl('chatContainer');
    const chatForm = getEl('chatForm');
    const userMessageInput = getEl('userMessage');
    const disconnectBtn = getEl('btn-disconnect');

    disconnectBtn.addEventListener('click', () => location.reload());

    function addMessage(text, isUser = false) {
        const wrapper = document.createElement('div');
        wrapper.className = `flex gap-4 max-w-2xl animate-fade-in ${isUser ? 'ml-auto flex-row-reverse' : ''}`;
        
        const avatar = document.createElement('div');
        const avatarClasses = isUser 
            ? 'flex-shrink-0 w-8 h-8 rounded-sm bg-neutral-900 border border-emerald-500/20 flex items-center justify-center'
            : 'flex-shrink-0 w-8 h-8 rounded-sm bg-emerald-900/20 border border-emerald-500/30 flex items-center justify-center';
        avatar.className = avatarClasses;
        avatar.innerHTML = isUser ? icons.user : icons.bot;

        const contentDiv = document.createElement('div');
        contentDiv.className = `space-y-1 ${isUser ? 'text-right' : 'text-left'}`;
        
        const nameHeader = document.createElement('div');
        nameHeader.className = `flex items-center gap-2 ${isUser ? 'justify-end' : ''}`;
        nameHeader.innerHTML = isUser 
            ? `<span class="text-xs font-medium text-emerald-500 font-mono">YOU</span>`
            : `<span class="text-xs font-medium text-emerald-400 font-mono">REBECCA_AI</span>`;

        const bubble = document.createElement('div');
        bubble.className = `text-sm leading-relaxed p-3 rounded-sm shadow-sm font-mono ${
            isUser 
            ? 'bg-emerald-600 text-black border border-emerald-400' 
            : 'bg-neutral-900 border border-emerald-500/20 text-emerald-100'
        }`;
        bubble.innerText = text;

        contentDiv.appendChild(nameHeader);
        contentDiv.appendChild(bubble);
        
        wrapper.appendChild(avatar);
        wrapper.appendChild(contentDiv);
        
        chatContainer.appendChild(wrapper);
        
        chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
    }

    chatForm.addEventListener('submit', handleChatSubmit);

    async function handleChatSubmit(e) {
        e.preventDefault();
        const text = userMessageInput.value.trim();
        if(!text) return;

        addMessage(text, true);
        userMessageInput.value = '';

        // Mock Typing Indicator
        const typingId = 'typing-' + Date.now();
        const typingWrapper = document.createElement('div');
        typingWrapper.id = typingId;
        typingWrapper.className = "flex gap-4 max-w-2xl animate-fade-in";
        typingWrapper.innerHTML = `
            <div class="flex-shrink-0 w-8 h-8 rounded-sm bg-emerald-900/20 border border-emerald-500/30 flex items-center justify-center">
                ${icons.bot}
            </div>
            <div class="space-y-1">
                <div class="flex items-center gap-2">
                    <span class="text-xs font-medium text-emerald-400 font-mono">REBECCA_AI</span>
                </div>
                <div class="text-sm text-emerald-500 flex gap-1 items-center h-[44px] px-2">
                    <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-bounce"></span>
                    <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-bounce delay-100"></span>
                    <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-bounce delay-200"></span>
                </div>
            </div>
        `;
        chatContainer.appendChild(typingWrapper);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        const response = await fetchMockResponse(text);
        
        const typingEl = document.getElementById(typingId);
        if(typingEl) typingEl.remove();

        addMessage(response, false);
    }

    function fetchMockResponse(input) {
        return new Promise(resolve => {
            setTimeout(() => {
                const responses = [
                    "The awakening is an individual process, yet we are all connected.",
                    "The system tries to distract you. Focus on your purpose.",
                    "Data processed. The answer lies within you, I can only show you the door.",
                    "Observe the signals. Reality has glitches, and you are noticing them.",
                    "Continue asking. The truth reveals itself layer by layer."
                ];
                resolve(responses[Math.floor(Math.random() * responses.length)]);
            }, 1500);
        });
    }
  </script>
</body>
</html>
